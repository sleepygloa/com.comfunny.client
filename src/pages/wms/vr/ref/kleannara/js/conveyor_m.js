var conveyor_map = [
	[ '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, '          '	, 'R_M12_03_L'	, 'R_M12_99_X'	, 'R_M12_04_R'	, '          '	, '          '	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, '          '	, 'R_M11_03_L'	, 'R_M11_99_X'	, 'R_M11_04_R'	, '          '	, '          '	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, '          ' ],
	[ '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, '          '	, '          '	, '          '	, 'R_M12_02_U'	, '          '	, '          '	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, '          '	, '          '	, '          '	, 'R_M11_02_U'	, '          '	, '          '	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, '          '	, '          ' ],
	[ '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, '          '	, '          '	, 'R_M12_01_U'	, '          '	, '          '	, '          '	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, '          '	, '          '	, 'R_M11_01_U'	, '          '	, '          '	, '          '	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, 'BGL_A_00_X'	, '          ' ],
	[ '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, 'R_M05_00_U'	, '          '	, '          '	, '          '	, '          '	, '          '	, '          ' ],
	[ '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, 'R_M08_02_L'	, 'R_M07_01_L'	, 'R_M07_02_L'	, 'R_M07_03_L'	, 'R_M07_04_L'	, 'R_M07_00_L'	, 'T_M07_05_L'	, 'R_M07_00_L'	, 'R_M06_01_L'	, 'R_M06_02_L'	, 'R_M06_03_L'	, 'R_M06_04_L'	, 'R_M06_05_L'	, 'R_M06_00_L'	, 'T_M06_06_L'	, 'R_M06_00_L'	, 'R_M05_01_L'	, 'R_M05_02_L'	, 'R_M05_03_L'	, 'R_M05_04_L'	, '          '	, 'T_M05_05_U'	, '          '	, '          '	, '          '	, '          '	, '          '	, '          ' ],
	[ '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, 'R_M05_00_U'	, '          '	, '          '	, '          '	, '          '	, '          '	, '          ' ],
	[ '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, 'C_M08_01_L'	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, 'R_M05_06_U'	, '          '	, '          '	, '          '	, '          '	, '          '	, '          ' ],
	[ '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, 'R_M05_07_U'	, '          '	, '          '	, '          '	, '          '	, '          '	, '          ' ],
	[ '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, 'R_M02_00_U'	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          ' ],
	[ '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, 'T_M02_07_U'	, '          '	, 'R_M02_06_R'	, 'R_M02_05_R'	, 'R_M02_04_R'	, 'R_M02_03_R'	, 'R_M02_02_R'	, 'R_M02_01_R'	, 'R_M03_20_R'	, 'R_M03_19_R'	, 'R_M03_18_R'	, 'R_M03_17_R'	, 'R_M03_16_R'	, 'R_M03_15_R'	, 'R_M03_14_R'	, 'R_M03_13_R'	, 'R_M03_12_R'	, 'R_M03_11_R'	, 'R_M03_10_R'	, 'R_M03_09_R'	, 'R_M03_08_R'	, 'R_M03_07_R'	, 'R_M03_06_R'	, 'R_M03_05_R'	, 'R_M03_04_R'	, 'R_M03_03_R'	, 'R_M03_02_R'	, 'R_M03_01_R'	, 'R_M05_00_R'	, 'T_M05_08_R'	, 'R_M05_00_R'	, 'R_M04_05_R'	, 'R_M04_04_R'	, 'R_M04_03_R'	, 'R_M04_02_R'	, 'R_M04_01_R' ],
	[ '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, 'R_M02_00_U'	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          ' ],
	[ '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, 'R_M0101_01_U'	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          ' ],
	[ '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, 'R_M0101_02_U'	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X' ],
	[ '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, 'R_M0101_03_U'	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X' ],
	[ '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, 'R_M0101_04_U'	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X' ],
	[ '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, 'R_M0101_05_U'	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X'	, '          '	, 'BGL_B_00_X'	, 'BGL_B_00_X' ],
	[ '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          ' ],
	[ 'R_M00_04_R'	, 'R_M00_03_R'	, 'R_M00_02_R'	, 'R_M00_01_R'	, 'R_M0102_04_R'	, 'R_M0102_03_R'	, 'R_M0102_02_R'	, 'R_M0102_01_R'	, 'R_M0101_08_R'	, 'R_M0101_07_R'	, 'R_M0101_00_R'	, 'T_M0101_06_R'	, 'R_M0101_00_R'	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          '	, '          ' ]
];

/******************************************************************************************************
 * Conveyor 객체
 ******************************************************************************************************/
var conveyor_info = {
		
	squareside: 80,
	height: 	6
};

var roller_info = {

	radius: 	5,
	height: 	30,
	segments: 	8,		// n각
	speed:		10
};

var turntable_info = {

	radius: 	110,
	height: 	6,
	segments: 	32,		// n각
	speed:		10
};

var conveyor_arr = [];

var conveyor_geometry = new THREE.BoxBufferGeometry( conveyor_info.squareside, conveyor_info.height, conveyor_info.squareside );
var conveyor_material = new THREE.MeshLambertMaterial( { color: 0xb7f0b1, transparent: true, opacity: 0.5 } );

var roller_geometry = new THREE.CylinderGeometry( roller_info.radius, roller_info.radius, roller_info.height, roller_info.segments );
var roller_material_1 = new THREE.MeshPhongMaterial( {color: 0xffe400} );
var roller_material_2 = new THREE.MeshPhongMaterial( {color: 0x0054ff} );

var turntable_geometry = new THREE.CylinderGeometry( turntable_info.radius, turntable_info.radius, turntable_info.height, turntable_info.segments );
var turntable_material = new THREE.MeshPhongMaterial( {color: 0xffff36} );

// 방향표시등
var direction_geometry = new THREE.CylinderGeometry( 25, 25, 1, 3 );
var direction_material = new THREE.MeshPhongMaterial( {color: 0xff0000} );

// 배경 Location A Zone
var locationA_geometry = new THREE.CylinderGeometry( 40, 40, 10, 32 );
var locationA_material = new THREE.MeshLambertMaterial( { color: 0xfafafa } );
//배경 Location B Zone
var locationB_geometry = new THREE.BoxBufferGeometry( 80, 10, 80 );
var locationB_material = new THREE.MeshLambertMaterial( { color: 0xfafafa } );

var conveyorGeometry = function( prameter ) {

	var roller_arr = [];
	var direction_arr = [];
	var conveyor_object = null;

	(function( conveyorGeometry ) {
		
		conveyorGeometry.draw = function () {

			conveyor_object = new THREE.Mesh( conveyor_geometry, conveyor_material );
			if( prameter.kind == 'R' && prameter.direction == 'X' ){	// 예외적 직각 Conveyor
				conveyor_object.position.set( prameter.position[0], prameter.position[1] + 37, prameter.position[2] + 37 );
				conveyor_object.rotation.x = 0.5 * Math.PI;
			} else {
				conveyor_object.position.set( prameter.position[0], prameter.position[1], prameter.position[2] );
			}

			// 객체정보
			conveyor_object.name = prameter.conveyor;
			conveyor_object.type = 'conveyor';
			conveyor_object.kind = prameter.kind;
			conveyor_object.group = prameter.group;
			conveyor_object.number = prameter.number;
			conveyor_object.direction = prameter.direction;
			conveyor_object.work = prameter.work;
			//conveyor_object.next = null;
			//conveyor_object.stok_existence = null;

			// 배경 영역은 배열에 저장안함
			if( prameter.kind != 'BGL' && prameter.number != '00' ) conveyor_arr.push( conveyor_object );
			
			// Turntable 영역은 바닥 안그림
			if( prameter.kind != 'T' && prameter.number != '00' ) warehouse.scene.add( conveyor_object );

			// Turntable ==============================================================================
			if( prameter.kind == 'T' ){

				var  turntable_object = new THREE.Mesh( turntable_geometry, turntable_material );
				turntable_object.position.set( prameter.position[0], prameter.position[1], prameter.position[2] );

				// 객체정보
				turntable_object.type = 'turntable';
				turntable_object.conveyor = conveyor_object;
				
				warehouse.scene.add( turntable_object );
				
				// Turntable Roller
			    for(var i=0 ; i<8 ; i++){
			    	
					var roller_object = null;
	
					if( i % 2 == 0 ){
						roller_object = new THREE.Mesh( roller_geometry, roller_material_1 );
						
					} else {
						roller_object = new THREE.Mesh( roller_geometry, roller_material_2 );
					}
					
					// 컨베이어의 방향과 그에 따른 롤러의 위치 결정
				    var roller_position_y = conveyor_info.height + roller_info.radius;
				    
					if( prameter.direction == 'R' || prameter.direction == 'L' ){
						var x = (prameter.position[0] -35) + (i * 10);
						var y = 0;
						var z = prameter.position[2];
						roller_object.position.set( x, y, z  );
						roller_object.rotation.x = 0.5 * Math.PI;
						
					} else if( prameter.direction == 'U' || prameter.direction == 'D' ){
						var x = prameter.position[0];
						var y = 0;
						var z = (prameter.position[2] - 35) + (i * 10);
						roller_object.position.set( x, y, z  );
						roller_object.rotation.z = 0.5 * Math.PI;
					}

					// 객체정보
					roller_object.type = 'roller';
					roller_object.conveyor = conveyor_object;
					
					warehouse.scene.add( roller_object );
					roller_arr.push( roller_object );
			    }
			}

			// Roller ==============================================================================
			if( prameter.kind == 'R' ){
				if( prameter.number == '00' || prameter.number == '99' ) {	// 99는 예외적 직각방향 Roller
					
					// Turntable Sub Roller
				    for(var i=0 ; i<6 ; i++){
				    	
						var roller_object = null;
		
						if( i % 2 == 0 ){
							roller_object = new THREE.Mesh( roller_geometry, roller_material_1 );
							
						} else {
							roller_object = new THREE.Mesh( roller_geometry, roller_material_2 );
						}
						
						// 컨베이어의 방향과 그에 따른 롤러의 위치 결정
					    var roller_position_y = conveyor_info.height + roller_info.radius;
					    
						if( prameter.direction == 'R' || prameter.direction == 'L' ){
							var x = (prameter.position[0] -25) + (i * 10);
							var y = 0;
							var z = prameter.position[2];
							roller_object.position.set( x, y, z  );
							roller_object.rotation.x = 0.5 * Math.PI;
							
						} else if( prameter.direction == 'U' || prameter.direction == 'D' ){
							var x = prameter.position[0];
							var y = 0;
							var z = (prameter.position[2] - 25) + (i * 10);
							roller_object.position.set( x, y, z  );
							roller_object.rotation.z = 0.5 * Math.PI;
							
						} else if( prameter.direction == 'X' ){
							var x = (prameter.position[0] -25) + (i * 10);
							var y = 40;
							var z = prameter.position[2] + 40;
							roller_object.position.set( x, y, z  );
							//roller_object.rotation.x = 0.5 * Math.PI;
							//roller_object.rotation.y = 0.5 * Math.PI;
						}
						
						// 객체정보
						roller_object.type = 'roller';
						roller_object.conveyor = conveyor_object;
						
						warehouse.scene.add( roller_object );
						roller_arr.push( roller_object );
				    }
				    
				} else {
					// Roller
				    for(var i=0 ; i<8 ; i++){
				    	
						var roller_object = null;
		
						if( i % 2 == 0 ){
							roller_object = new THREE.Mesh( roller_geometry, roller_material_1 );
							
						} else {
							roller_object = new THREE.Mesh( roller_geometry, roller_material_2 );
						}
						
						// 컨베이어의 방향과 그에 따른 롤러의 위치 결정
					    var roller_position_y = conveyor_info.height + roller_info.radius;
					    
						if( prameter.direction == 'R' || prameter.direction == 'L' ){
							var x = (prameter.position[0] -35) + (i * 10);
							var y = 0;
							var z = prameter.position[2];
							roller_object.position.set( x, y, z  );
							roller_object.rotation.x = 0.5 * Math.PI;
							
						} else if( prameter.direction == 'U' || prameter.direction == 'D' ){
							var x = prameter.position[0];
							var y = 0;
							var z = (prameter.position[2] - 35) + (i * 10);
							roller_object.position.set( x, y, z  );
							roller_object.rotation.z = 0.5 * Math.PI;
						}
		
						roller_object.type = 'roller';
						roller_object.conveyor = conveyor_object;
						
						warehouse.scene.add( roller_object );
						roller_arr.push( roller_object );
				    }
				}
			}
			
		    // 롤러 위의 방향표시등 ==============================================================================
		    var direction_object = new THREE.Mesh( direction_geometry, direction_material );
		    direction_object.position.set( prameter.position[0], roller_info.radius - 1, prameter.position[2] );
		    direction_object.material.opacity = 0.5;			// 투명도
		    direction_object.material.transparent = true;		// transparent: 투명

		    // 크래인 등 특별한 구간에서는 방향등 예외처리
		    if( prameter.conveyor == 'C_M08_01_L' ){
		    	
		    } else {
		    	
			    switch( prameter.direction ){
		    	case 'L': direction_object.rotation.y = -0.5 * Math.PI; break;
		    	case 'R': direction_object.rotation.y = 0.5 * Math.PI; break;
		    	case 'U': direction_object.rotation.y = 1 * Math.PI; break;
		    	case 'D': break;
			    }
		    }
		    
		    direction_object.type = 'direction';
		    direction_object.conveyor = conveyor_object;
		    direction_arr.push( direction_object );
		    
			// Turntable 영역은 방향표시등 안그림
			if( prameter.kind != 'T' && prameter.number != '00' && prameter.number != '99' ) warehouse.scene.add( direction_object );
			
			// 배경의 다른 Location A, B ==============================================================================
			if( prameter.kind == 'BGL' ){

				if( prameter.group == 'A' ) {
					var locationA_object = new THREE.Mesh( locationA_geometry, locationA_material );
					locationA_object.material.opacity = 0.8;				// 투명도
					locationA_object.material.transparent = true;			// transparent: 투명
					locationA_object.position.set( prameter.position[0], 5, prameter.position[2] );

					warehouse.scene.add( locationA_object );
					
				} else if( prameter.group == 'B' ) {
					var  locationB_object = new THREE.Mesh( locationB_geometry, locationB_material );
					locationB_object.material.opacity = 0.8;				// 투명도
					locationB_object.material.transparent = true;			// transparent: 투명
					locationB_object.position.set( prameter.position[0], 5, prameter.position[2] );

					warehouse.scene.add( locationB_object );
				}
			}
	    }
		
		conveyorGeometry.run = function () {

			// 롤러회전
			for(var i=0 ; i<roller_arr.length ; i++){
				
				// 롤러의 상태가 ON 일때만 회전
				if(conveyor_object.work == 'ON'){
					// 컨베이어의 방향에 따른 롤러의 회전방향 결정
					switch( prameter.direction ){
						case 'R':	roller_arr[i].rotation.y -= 0.1; break;
						case 'L':	roller_arr[i].rotation.y += 0.1; break;
						case 'U':	roller_arr[i].rotation.x -= 0.1; break;
						case 'D':	roller_arr[i].rotation.x += 0.1; break;
					}
				}
			}
			
			// 방향표시등
			for(var i=0 ; i<direction_arr.length ; i++){
				
				// 롤러의 상태가 ON 일때 녹색들 OFF 일때 빨간등 켜짐
				if(conveyor_object.work == 'ON'){
					direction_arr[i].material.color.setHex( 0x00ff00 );
					
				} else {
					direction_arr[i].material.color.setHex( 0xff0000 );
				}
			}
			
			requestAnimationFrame( conveyorGeometry.run );
		}
	})(this);
}

/******************************************************************************************************
 * Conveyor 생성 및 동작
 ******************************************************************************************************/
// conveyor_map 정보를 기반으로 컨베이어 생성
function setConveyor(center_x, center_z, conveyor_map, callback) { 

	var x = center_x;
	var z = center_z;

	for (var i = 0; i < conveyor_map.length; i++) {

		x = center_x;
		z = z + conveyor_info.squareside;
		
		for (var j = 0; j < conveyor_map[i].length; j++) {
			
			x = x + conveyor_info.squareside;
			
			if( conveyor_map[i][j].trim() != '' ){

				// S_A_001_U : Conveyor Type(Roll, Turntable) _ Group Code _ Number _ Direction(Up, Down, Left, Right, End, X)
				var conveyor_name_info = conveyor_map[i][j].split('_');

				var conveyor_geometry = new conveyorGeometry( {
					conveyor: conveyor_map[i][j],
					kind: conveyor_name_info[0],
					group: conveyor_name_info[1],
					number: conveyor_name_info[2],
					direction: conveyor_name_info[3],
					position: [x, -3, z],
					work: 'ON'
				});

				conveyor_geometry.draw();
				conveyor_geometry.run();
			}
		}
	} 
	
	if( callback != null ) callback();
}

//컨베이어 동작
function onConveyor ( group ) {

	for (var i = 0; i < conveyor_arr.length; i++) {

		if( conveyor_arr[i].group == group ){

			conveyor_arr[i].work = 'ON';
		}
	}
	
}

// 컨베이어 정지
function offConveyor ( group ) {
	
	for (var i = 0; i < conveyor_arr.length; i++) {
		
		if( conveyor_arr[i].group == group ){
			
			conveyor_arr[i].work = 'OFF';
		}
	}
}